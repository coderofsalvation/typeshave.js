// Generated by CoffeeScript 1.8.0
(function() {
  var tv4;

  tv4 = require('tv4');

  module.exports = {
    typesafe: function(schema, method) {
      var validated;
      validated = function() {
        var args, e, i, k, v, _i, _len, _ref;
        if (schema.type == null) {
          args = {};
          i = 0;
          for (k in schema) {
            v = schema[k];
            args[k] = arguments[String(i++)];
          }
          schema = {
            type: "object",
            required: Object.keys(schema),
            properties: schema
          };
          arguments[0] = args;
        }
        v = tv4.validateMultiple(arguments[0], schema);
        if (!v.valid) {
          if (process.env.DEBUG) {
            console.log(JSON.stringify({
              data: arguments[0],
              errors: v,
              schema: schema
            }, null, 2));
          } else {
            _ref = v.errors;
            for (_i = 0, _len = _ref.length; _i < _len; _i++) {
              e = _ref[_i];
              console.log("typesafe error: " + String(e.dataPath).replace(/\//g, '.') + " " + e.message);
            }
          }
          throw "TYPESAFE_FAIL";
        } else {
          console.log("all fine");
        }
        return method.apply(this, arguments);
      };
      return validated;
    }
  };

}).call(this);
